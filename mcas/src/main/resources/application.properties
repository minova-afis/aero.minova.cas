# CAS - Micro Core Application System
# Only non-default settings are configured here

####### �CAS SPECIFIC SETTINGS (REQUIRED) #######

#### NextGen Database File Access (�CAS Core Feature) ####
ng.api.preferdbfiles=true
ng.api.dbfiles=true
ng.api.dbregistry=true
ng.api.mdimix=true
ng.api.autosetup=true
ng.api.autosetup.force=false

#### Fat-JAR Mode ####
fat.jar.mode=true

#### Automatic Database Setup ####
# Auto-setup eliminates manual POST /setup calls - database initializes on first boot
ng.api.autosetup=true
# Set to true to force setup on every boot (useful for development/testing)
# ng.api.autosetup.force=false

#### Application Root Path ####
aero.minova.core.application.root.path=/

#### Database Configuration (REQUIRED - Override in deployment) ####
spring.datasource.url=jdbc:sqlserver://localhost:1433;databaseName=YOUR_DB;encrypt=true;trustServerCertificate=true
spring.datasource.driverClassName=com.microsoft.sqlserver.jdbc.SQLServerDriver
#spring.datasource.username=YOUR_USER  
#spring.datasource.password=YOUR_PASSWORD

#### JPA/Hibernate Settings (Required for CAS) ####
spring.jpa.hibernate.ddl-auto=update
spring.jpa.database-platform=org.hibernate.dialect.SQLServerDialect
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl

#### JSON Processing ####
spring.http.converters.preferred-json-mapper=gson

#### Authentication Method ####
# Auto-setup no longer requires login_dataSource=admin - it creates its own temporary security context
# Configure authentication based on your deployment:
# - ldap: Use LDAP/Active Directory authentication
# - database: Use xtcasUsers table authentication
# - admin: In-memory admin user (for testing only - DO NOT use in production)
login_dataSource=database

#### Server Configuration ####
server.servlet.context-path=/cas
server.port=8084
cors.allowed.origins=https://ng-dev.minova.com,https://ng.minova.com,http://localhost,https://editor.swagger.io/

#### Management/Monitoring ####
management.server.port=8081
management.endpoints.enabled-by-default=false

#### HikariCP Connection Pool Settings ####

# SEE DISCUSSION ON THESE VALUES IN doc/Hikari.md

# maximumPoolSize (default: 10) - Maximum number of connections in pool
# Implication: Higher = more concurrent requests but more DB resources/ports consumed
# NOT SET - using default (10) to avoid port exhaustion (see TTA issue #2052)
# If pool exhaustion occurs frequently, increase cautiously (e.g., 15-20)
spring.datasource.hikari.maximumPoolSize=15

# minimumIdle (default: same as maximumPoolSize) - Minimum idle connections HikariCP maintains
# Implication: Lower = fewer idle connections, faster pool shrinking; Higher = faster response for bursts
# NOT SET - using default (equals maximumPoolSize) for consistent pool size
#spring.datasource.hikari.minimumIdle=10

# connectionTimeout (default: 30000ms = 30s) - Max time to wait for connection from pool
# Implication: If all connections busy, request waits this long before throwing SQLException
# NOT SET - using default (30s) which is reasonable for most cases
#spring.datasource.hikari.connectionTimeout=30000

# keepaliveTime (default: 0 = disabled) - How often to test idle connections (must be < maxLifetime)
# Implication: Prevents DB from closing idle connections; detects broken connections early
# SET TO 30s - keeps connections alive, prevents "connection reset" errors
spring.datasource.hikari.keepaliveTime=30000

# leakDetectionThreshold (default: 0 = disabled) - Logs warning if connection held longer than this
# Implication: Helps detect connection leaks (unclosed connections in code)
# SET TO 20min - long enough for procedures up to 15min, useful for daily closing operations
spring.datasource.hikari.leakDetectionThreshold=1200000

# maxLifetime (default: 1800000ms = 30min) - Max lifetime of connection in pool
# Implication: Connections closed after this time to avoid stale connections and DB-side timeouts
# SET TO 30min - allows long-running procedures (up to 15min) with safety margin
spring.datasource.hikari.maxLifetime=1800000

# idleTimeout (default: 600000ms = 10min) - Max time connection can sit idle before being retired
# Implication: Only applies if minimumIdle < maximumPoolSize; reduces idle connections
# NOT SET - not relevant since minimumIdle = maximumPoolSize (pool doesn't shrink)
#spring.datasource.hikari.idleTimeout=600000

# validationTimeout (default: 5000ms = 5s) - Max time to wait for connection validation query
# Implication: If validation takes longer, connection considered invalid and discarded
# NOT SET - using default (5s) which is sufficient for most databases
#spring.datasource.hikari.validationTimeout=5000

# autoCommit (default: true) - Whether connections have auto-commit enabled
# Implication: We set to FALSE globally in code (systemDatabase.getConnection()) for explicit transaction control
# NOT SET - controlled programmatically, not via properties
#spring.datasource.hikari.autoCommit=true

####### SPRING BOOT DEFAULTS - ALREADY CONFIGURED ABOVE #######

# The following are now set explicitly above (not defaults):

# spring.application.name=�CAS - Micro Core Application System
# spring.datasource.driverClassName=com.microsoft.sqlserver.jdbc.SQLServerDriver
# spring.jpa.hibernate.ddl-auto=update  
# spring.jpa.database-platform=org.hibernate.dialect.SQLServerDialect
# spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl

# Thymeleaf defaults (all are Spring Boot defaults):
# spring.thymeleaf.check-template=true
# spring.thymeleaf.check-template-location=true
# spring.thymeleaf.content-type=text/html
# spring.thymeleaf.enabled=true
# spring.thymeleaf.encoding=UTF-8
# spring.thymeleaf.mode=HTML
# spring.thymeleaf.prefix=classpath:/templates/
# spring.thymeleaf.suffix=.html

# JSON Processing (Gson is configured via dependencies):
# spring.http.converters.preferred-json-mapper=gson

# Connection Pool (HikariCP - configured above):
# spring.datasource.hikari.maximumPoolSize=15
# spring.datasource.hikari.keepaliveTime=30000
# spring.datasource.hikari.leakDetectionThreshold=1200000
# spring.datasource.hikari.maxLifetime=1800000

####### DEVELOPMENT/DEBUGGING OPTIONS #######

# Uncomment these for development/debugging:
# spring.jpa.show-sql=true
# logging.level.org.hibernate.SQL=DEBUG
# logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

####### OPTIONAL SETTINGS #######

# CORS (uncomment if needed for web UI):
# cors.allowed.origins=http://localhost,https://localhost

# Hub functionality (uncomment if using):  
# minova.hub.host=hub.minova.com:32777
# minova.hub.client.name=µCAS-INSTANCE

# External library loading (uncomment if using external libs):
# loader.path=../lib/

# LDAP authentication (uncomment if using LDAP instead of database):
# login_dataSource=ldap

# Admin authentication (for testing only):
# login_dataSource=admin